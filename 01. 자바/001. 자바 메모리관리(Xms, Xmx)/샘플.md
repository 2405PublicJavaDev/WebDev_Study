# 자바 메모리 관리 (Xms, Xmx)

## Xms와 Xmx란

- Jar 파일을 실행할 때 초기 할당 메모리와 최대 메모리를 지정하는 옵션
- 사용할 최대, 최소 힙 크기를 지정하는 데 사용
- Java heap 메모리는 -Xms 로 지정한 메모리 크기로 시작하여 -Xmx 로 지정한 메모리 크키까지 커지게 됨

<br/>

## Xms란
- Java 힙의 최초 크기를 지정하는 것
- 이 매개변수를 적절하게 조정하면 가비지 콜렉션의 오버헤드를 줄여서 서버 응답 시간 및 처리량을 개선
- 일부 응용프로그램의 경우 이 옵션에 대한 기본 설정이 너무 낮아서 사소한 가비지 콜렉션의 수가 높아질 수 있음
- 기본값 : 
    - 50MB
    - 이 기본값은 31비트 및 64비트 구성 모두에 적용
- 권장 : 
    - 워크로드에 특정하지만 기본값보다 높음
- 사용법 :
    - -Xms256m은 초기 힙 크기를 256MB로 설정

<br/>

## Xmx

- Java 힙의 최대 크기를 지정하는 것
- 이 매개변수를 늘리면 Application Server에 사용 가능한 메모리가 늘어나고 가비지 콜렉션 빈도가 줄어듦
- 이 설정을 늘리면 서버 응답 시간 및 처리량이 개선될 수 있음
- 그러나 이 설정을 늘리면 가비지 콜렉션이 발생할 때 해당 콜렉션의 지속 기간이 늘어남
- 이 설정은 Application Server 인스턴스에 대해 사용 가능한 시스템 메모리 이상으로 증가해서는 안됨
- 설정을 사용 가능한 시스템 메모리 이상으로 늘리면 시스템 페이징 및 상당한 성능 감소를 유발할 수 있음
- 기본값 : 
    - 256MB
    - 이 기본값은 31비트 및 64비트 구성 모두에 적용
- 권장 : 
    - 워크로드에 특정하지만 사용 가능한 실제 메모리의 양에 따라서 기본값보다 높음
- 사용법 : 
    - -Xmx512m은 최대 힙 크기를 512MB로 설정

<br/>

## 사용 이유

- JVM은 메모리가 부족하게 되면 OS에 메모리를 추가 요청하는 방식으로 힙 사이즈를 조정
- 이때 GC 가 발생하게 되고 JVM은 필요한 만큼 힙사이즈를 늘려가게 됨
- 이렇게 조정하다가 만약 머신의 물리 메모리 사이즈를 넘어가게 되면 가상 메모리를 사용하면서 swap space로 swap in - out 을 하게 됨
- 이때 swap 영역은 Disk가 되므로 오버헤드가 발생
- swap 영역인 Disk에 읽기 쓰기를 하고 동시에 GC도 발생한다면 꽤 큰 성능이슈가 있을 것으로 예상됨
- 또한 Xmx 와 Xms가 동일하지 않을 때에도 문제는 발생 가능
- Xms 가 너무 작은 경우 빈번한 GC를 수행
- 이 때 메모리를 추가 요청하면서 결국 Xmx와 동일한 사이즈를 갖게 됨
- 즉 상용환경에서는 처음부터 -Xmx 으로 지정한 Heap 메모리 크기를 가지고 시작하는 것이 좋고, 결국엔 -Xms 로 지정한 메모리 크기와 -Xmx 로 지정한 메모리 크기를 같게해 Java 프로그램을 구동하게 되는 것


<br/>
<br/>
<br/>
<br/>

#### 참고 자료

- https://fathory.tistory.com/19
- https://binux.tistory.com/65
- https://sjparkk-dev1og.tistory.com/222
- https://liltdevs.tistory.com/175